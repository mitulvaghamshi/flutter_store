import 'package:flutter/cupertino.dart';
import 'package:flutter_store/ajson_app/api/repo.dart';
import 'package:flutter_store/ajson_app/tabs/gita_screen.dart';

@immutable
mixin Gita on GitaScreen {
  static Future<Repo<Chapter>> get query =>
      Repo.asset('assets/gita.json', Chapter.fromJson);
}

@immutable
class Chapter {
  const Chapter({required this.id, required this.title, required this.verses});

  factory Chapter.fromJson(Object? json) {
    if (json case {
      'id': int id,
      'title': String title,
      'verses': List<dynamic> verses,
    }) {
      final items = List<Map<String, dynamic>>.from(verses);
      return Chapter(id: id, title: title, verses: items.map(Verse.fromJson));
    }
    throw '[Chapter]: Invalid JSON data';
  }

  final int id;
  final String title;
  final Iterable<Verse> verses;

  int get actualVerseCount => verses.where((v) => !v.isSpeaker).length;
}

@immutable
class Verse {
  const Verse({required this.isSpeaker, required this.content});

  factory Verse.fromJson(Map<String, dynamic> json) {
    if (json case {'speaker': bool speaker, 'content': String content}) {
      return Verse(isSpeaker: speaker, content: content);
    }
    throw '[Verse]: Invalid JSON data';
  }

  final bool isSpeaker;
  final String content;
}
